<html>
  <head>
    <script>
    let x = "x";
    let y = "y";
    let z = "z";
    let allNodes = [x, y, z]

    function Connection(from, to, cost) {
      return {from, to, cost};
    }
    
    function NodeTable() {
      let nodeTable = {};
      allNodes.forEach((fromNode, i) => {
          nodeTable[fromNode] = {};
          allNodes.forEach((toNode, i) => {
            nodeTable[fromNode][toNode] = Infinity;
          });
      });
      return nodeTable;
    };

    function Node(self, connections) {
      let nodeTable = {}
      if(Array.isArray(connections)) { //connections are in array format
        nodeTable = NodeTable();
        connections.forEach((connection, i) => {
          nodeTable[connection["from"]][connection["to"]] = connection["cost"];
        });
      } else { //connections are in table format
        nodeTable = connections;
      }

      return {self, nodeTable};
    }

    let isEqual = (node, otherNode) => {
      let result = true;
      allNodes.forEach((fromNode, i) => {
        allNodes.forEach((toNode, i) => {
          result = result && (node.nodeTable[fromNode][toNode] === otherNode.nodeTable[fromNode][toNode]);
        })
      });
      return result;
    }

    let updateTable = (node, otherNode) => {
      let newTable = NodeTable();
      allNodes.forEach((fromNode, i) => {
        allNodes.forEach((toNode, i) => {
          //If we're looking at our data, use the Bellman-Ford equation
          if(fromNode === node.self) {
            newTable[fromNode][toNode] = Math.min(
              node.nodeTable[node.self][otherNode.self] + otherNode.nodeTable[otherNode.self][toNode],
              node.nodeTable[node.self][toNode]
            );
          } else { //Otherwise just hoover up everyone else's data
            newTable[fromNode][toNode] = Math.min(node.nodeTable[fromNode][toNode], otherNode.nodeTable[fromNode][toNode]);
          }
        });
      });
      return Node(node.self, newTable);
    }

    function calculateDVTables(nodes) {
      let sampleNode = nodes[0];
      let i = 1;
      console.log("Nodes at step " + i + ":");
      console.dir(nodes);

      while(!nodes.reduce((previousResult, curNode) => previousResult && isEqual(sampleNode, curNode), true)) {
        let newNodes = nodes.map((node) => {
          let newNode = {...node};
          nodes.forEach((updateNode, i) => {
            newNode = updateTable(newNode, updateNode);
          });
          return newNode;
        });
        nodes = newNodes;
        sampleNode = newNodes[0];
        i++;
        console.log("Nodes at step " + i + ":");
        console.dir(nodes);
      }
      console.log("DV tables completed after " + i + " steps.");
      return nodes;
    }

    let nodes = [
      Node(x, [Connection(x,x,0), Connection(x,y,2), Connection(x,z,7)]),
      Node(y, [Connection(y,x,2), Connection(y,y,0), Connection(y,z,1)]),
      Node(z, [Connection(z,x,7), Connection(z,y,1), Connection(z,z,0)])
    ]

    nodes = calculateDVTables(nodes);
    console.log("Final node tables: ");
    console.dir(nodes);

    </script>
  </head>
  <body>
  </body>
</html>